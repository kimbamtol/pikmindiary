{% extends 'base.html' %}
{% load i18n %}
{% load translate_content %}

{% block title %}{% trans "ë‚´ ë†ì‚¬ í™œë™" %} - {% trans "í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬" %}{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">ğŸ‘¤ {% trans "ë‚´ ë†ì‚¬ í™œë™" %}</h1>

    <div class="activity-tabs">
        <button class="tab-btn active" onclick="showTab('journals')">ğŸ“” {% trans "ë‚´ ì¼ì§€" %} ({{ my_journals.count }})</button>
        <button class="tab-btn" onclick="showTab('requests')">ğŸ†˜ {% trans "ë‚´ ìš”ì²­" %} ({{ my_requests.count }})</button>
        <button class="tab-btn" onclick="showTab('participations')">ğŸ™‹ {% trans "ì°¸ì—¬ ê¸°ë¡" %} ({{ my_participations.count }})</button>
    </div>

    <!-- ë‚´ ì¼ì§€ -->
    <div id="journals-tab" class="tab-content active">
        <div class="section-header">
            <h2>ğŸ“” {% trans "ë‚´ê°€ ì“´ ë†ì‚¬ ì¼ì§€" %}</h2>
            <a href="{% url 'farming:journal_create' %}" class="btn btn-primary btn-sm">{% trans "ì¼ì§€ ì‘ì„±" %}</a>
        </div>
        <div class="activity-grid">
            {% for journal in my_journals %}
            <a href="{% url 'farming:journal_detail' journal.pk %}" class="activity-card">
                <h3>{{ journal|translate_field:"title" }}</h3>
                <p>{{ journal.created_at|date:"Y.n.j" }}</p>
                {% if journal.location_name %}
                <p class="location">ğŸ“ {{ journal.location_name }}</p>
                {% endif %}
            </a>
            {% empty %}
            <p class="empty-text">{% trans "ì‘ì„±í•œ ë†ì‚¬ ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤." %}</p>
            {% endfor %}
        </div>
    </div>

    <!-- ë‚´ ìš”ì²­ -->
    <div id="requests-tab" class="tab-content">
        <div class="section-header">
            <h2>ğŸ†˜ {% trans "ë‚´ê°€ ì˜¬ë¦° ìš”ì²­" %}</h2>
            <a href="{% url 'farming:request_create' %}" class="btn btn-primary btn-sm">{% trans "ìš”ì²­í•˜ê¸°" %}</a>
        </div>
        <div class="activity-grid">
            {% for req in my_requests %}
            <a href="{% url 'farming:request_detail' req.pk %}" class="activity-card">
                <span class="status-badge status-{{ req.status }}">{{ req.get_status_display }}</span>
                <h3>{{ req|translate_field:"title" }}</h3>
                <p>{{ req.created_at|date:"Y.n.j" }}</p>
                <p class="location">ğŸ“ {{ req.location_name }}</p>
                <p class="participants">ğŸ™‹ {{ req.participations.count }}{% trans "ëª… ì°¸ì—¬" %}</p>
            </a>
            {% empty %}
            <p class="empty-text">{% trans "ì˜¬ë¦° ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤." %}</p>
            {% endfor %}
        </div>
    </div>

    <!-- ì°¸ì—¬ ê¸°ë¡ -->
    <div id="participations-tab" class="tab-content">
        <div class="section-header">
            <h2>ğŸ™‹ {% trans "ë‚´ê°€ ì°¸ì—¬í•œ ë†ì‚¬" %}</h2>
        </div>
        <div class="activity-grid">
            {% for p in my_participations %}
            <a href="{% url 'farming:request_detail' p.request.pk %}" class="activity-card">
                <span class="status-badge status-{{ p.request.status }}">{{ p.request.get_status_display }}</span>
                <h3>{{ p.request|translate_field:"title" }}</h3>
                <p>{% trans "ì°¸ì—¬ì¼" %}: {{ p.created_at|date:"Y.n.j" }}</p>
                <p class="location">ğŸ“ {{ p.request.location_name }}</p>
            </a>
            {% empty %}
            <p class="empty-text">{% trans "ì•„ì§ ì°¸ì—¬í•œ ë†ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤." %}</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    function showTab(tabName) {
        // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        // ì„ íƒëœ íƒ­ ë³´ì´ê¸°
        document.getElementById(tabName + '-tab').classList.add('active');
        event.target.classList.add('active');
    }
</script>

<style>
    .page-title {
        font-size: 1.8rem;
        text-align: center;
        padding: var(--spacing-xl) 0;
    }

    .activity-tabs {
        display: flex;
        gap: var(--spacing-sm);
        justify-content: center;
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
    }

    .tab-btn {
        padding: var(--spacing-sm) var(--spacing-lg);
        border-radius: var(--radius-full);
        background: var(--bg-primary);
        font-size: 0.95rem;
        transition: all var(--transition-fast);
    }

    .tab-btn:hover,
    .tab-btn.active {
        background: var(--primary);
        color: white;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .section-header h2 {
        font-size: 1.2rem;
    }

    .activity-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: var(--spacing-md);
    }

    .activity-card {
        background: var(--bg-primary);
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-fast);
    }

    .activity-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .activity-card h3 {
        font-size: 1.1rem;
        margin: var(--spacing-sm) 0;
        color: var(--text-primary);
    }

    .activity-card p {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .activity-card .location {
        margin-top: var(--spacing-sm);
    }

    .activity-card .participants {
        color: var(--primary);
        font-weight: 500;
    }

    .status-badge {
        display: inline-block;
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        font-weight: 600;
    }

    .empty-text {
        grid-column: 1 / -1;
        text-align: center;
        color: var(--text-secondary);
        padding: var(--spacing-xl);
    }

    .btn-sm {
        padding: var(--spacing-xs) var(--spacing-md);
        font-size: 0.85rem;
    }
</style>
{% endblock %}
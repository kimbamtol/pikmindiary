{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "ë†ì‚¬ ì¼ì§€ ìˆ˜ì •" %} - {% trans "í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬" %}{% endblock %}

{% block content %}
<div class="container">
    <div class="form-page">
        <h1 class="page-title">âœï¸ {% trans "ë†ì‚¬ ì¼ì§€ ìˆ˜ì •" %}</h1>

        <form method="post" enctype="multipart/form-data" class="journal-form">
            {% csrf_token %}

            <!-- ë¹„íšŒì› ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
            {% if not can_edit and journal.guest_password %}
            <div class="password-notice">
                <p>ğŸ”’ {% trans "ë¹„íšŒì› ê¸€ì…ë‹ˆë‹¤. ì‘ì„± ì‹œ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." %}</p>
            </div>
            <div class="form-group">
                <label class="form-label">{% trans "ë¹„ë°€ë²ˆí˜¸" %} *</label>
                <input type="password" name="password" class="form-control" required>
            </div>
            {% endif %}

            <div class="form-group">
                <label class="form-label">{% trans "ì œëª©" %} *</label>
                <input type="text" name="title" class="form-control" value="{{ journal.title }}" required
                    maxlength="100">
            </div>

            <div class="form-group">
                <label class="form-label">{% trans "ë‚´ìš©" %} *</label>
                <textarea name="content" class="form-control" rows="6" required>{{ journal.content }}</textarea>
            </div>

            <div class="form-group">
                <label class="form-label">{% trans "ìœ„ì¹˜ëª…" %}</label>
                <input type="text" name="location_name" class="form-control" value="{{ journal.location_name }}"
                    placeholder="{% trans "ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬" %}">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">{% trans "ê½ƒ ì¢…ë¥˜" %}</label>
                    <input type="text" name="flower_type" class="form-control" value="{{ journal.flower_type }}"
                        placeholder="{% trans "ì˜ˆ: ë¹¨ê°„ ê½ƒ" %}">
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "ì‹¬ì€ ê½ƒ ìˆ˜" %}</label>
                    <input type="number" name="flower_count" class="form-control" value="{{ journal.flower_count }}"
                        min="0">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">{% trans "ìœ„ë„" %}</label>
                    <input type="number" name="latitude" id="latitude" class="form-control" step="0.000001"
                        value="{{ journal.latitude|default:'' }}">
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "ê²½ë„" %}</label>
                    <input type="number" name="longitude" id="longitude" class="form-control" step="0.000001"
                        value="{{ journal.longitude|default:'' }}">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">{% trans "ì´ë¯¸ì§€" %}</label>
                {% if journal.image %}
                <div class="current-image">
                    <img src="{{ journal.image.url }}" alt="{% trans "í˜„ì¬ ì´ë¯¸ì§€" %}" style="max-width: 200px; margin-bottom: 10px;">
                    <p>{% trans "í˜„ì¬ ì´ë¯¸ì§€" %}</p>
                </div>
                {% endif %}
                <input type="file" name="image" class="form-control" accept="image/*">
            </div>

            <div class="form-actions">
                <a href="{% url 'farming:journal_detail' pk=journal.pk %}" class="btn btn-outline">{% trans "ì·¨ì†Œ" %}</a>
                <button type="submit" class="btn btn-primary btn-lg">{% trans "ìˆ˜ì •í•˜ê¸°" %}</button>
            </div>
        </form>
    </div>
</div>

<style>
    .form-page {
        max-width: 700px;
        margin: var(--spacing-xl) auto;
        padding: var(--spacing-xl);
        background: var(--bg-primary);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
    }

    .page-title {
        text-align: center;
        margin-bottom: var(--spacing-xl);
    }

    .password-notice {
        padding: var(--spacing-md);
        background: #E3F2FD;
        border-radius: var(--radius-md);
        margin-bottom: var(--spacing-lg);
        color: #1565C0;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-md);
    }

    .form-group {
        margin-bottom: var(--spacing-lg);
    }

    .form-label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 600;
    }

    .current-image {
        margin-bottom: var(--spacing-md);
    }

    .current-image img {
        border-radius: var(--radius-md);
    }

    .form-actions {
        display: flex;
        justify-content: space-between;
        gap: var(--spacing-md);
    }

    @media (max-width: 480px) {
        .form-row {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column-reverse;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const latInput = document.getElementById('latitude');
        const lngInput = document.getElementById('longitude');

        if (latInput && lngInput) {
            latInput.addEventListener('input', function (e) {
                const value = e.target.value;
                if (value.includes(',')) {
                    const parts = value.split(',');
                    if (parts.length === 2) {
                        const lat = parts[0].trim();
                        const lng = parts[1].trim();
                        latInput.value = lat;
                        lngInput.value = lng;
                        lngInput.focus();
                    }
                }
            });
        }
    });
</script>
{% endblock %}
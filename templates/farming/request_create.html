{% extends 'base.html' %}

{% block title %}ë†ì‚¬ ìš”ì²­ ì‘ì„± - í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬{% endblock %}

{% block content %}
<div class="container">
    <div class="form-container">
        <h1>ğŸ†˜ ë†ì‚¬ ìš”ì²­</h1>
        <p class="form-desc">ë¹…í”Œë¼ì›Œ ë†ì‚¬ë¥¼ ë„ì™€ì¤„ ë¶„ì„ ì°¾ì•„ë³´ì„¸ìš”!</p>

        <form method="post" class="farming-form">
            {% csrf_token %}

            <!-- ë¹„íšŒì› í•„ë“œ -->
            {% if not user.is_authenticated %}
            <div class="guest-notice">
                <p>ğŸ’¡ ë¹„íšŒì›ìœ¼ë¡œ ê¸€ì„ ì‘ì„±í•©ë‹ˆë‹¤. ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ë‹‰ë„¤ì„ *</label>
                    <input type="text" name="guest_nickname" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸ * <small>(ìˆ˜ì •/ì‚­ì œìš©)</small></label>
                    <input type="password" name="guest_password" class="form-control" required>
                </div>
            </div>
            {% endif %}

            <div class="form-group">
                <label class="form-label">ì œëª© *</label>
                <input type="text" name="title" class="form-control" placeholder="ì˜ˆ: ì‹ ì£¼ì¿ ì—­ ë¹…í”Œë¼ì›Œ ë„ì™€ì£¼ì„¸ìš”!" required>
            </div>

            <div class="form-group">
                <label class="form-label">ì„¤ëª…</label>
                <textarea name="content" class="form-control" rows="4" placeholder="ì–´ë–¤ ë„ì›€ì´ í•„ìš”í•œì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">ì¥ì†Œëª… *</label>
                <input type="text" name="location_name" class="form-control" placeholder="ì˜ˆ: ì‹ ì£¼ì¿ ì—­ ë‚¨ìª½ ì¶œêµ¬" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ìœ„ë„ *</label>
                    <input type="text" name="latitude" id="latitude" class="form-control" placeholder="35.6896"
                        required>
                </div>
                <div class="form-group">
                    <label class="form-label">ê²½ë„ *</label>
                    <input type="text" name="longitude" id="longitude" class="form-control" placeholder="139.7006"
                        required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">í•„ìš”í•œ ê½ƒ</label>
                    <input type="text" name="flower_type" class="form-control" placeholder="ì˜ˆ: ë¹¨ê°„ ê½ƒ, ì•„ë¬´ ê½ƒì´ë‚˜">
                </div>
                <div class="form-group">
                    <label class="form-label">ë§ˆê° ì‹œê°„</label>
                    <input type="datetime-local" name="deadline" class="form-control">
                </div>
            </div>

            <div class="form-actions">
                <a href="{% url 'farming:request_list' %}" class="btn btn-outline">ì·¨ì†Œ</a>
                <button type="submit" class="btn btn-primary">ìš”ì²­í•˜ê¸°</button>
            </div>
        </form>
    </div>
</div>

<style>
    .form-container {
        max-width: 600px;
        margin: var(--spacing-xl) auto;
        background: var(--bg-primary);
        padding: var(--spacing-xl);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
    }

    .form-container h1 {
        font-size: 1.5rem;
        margin-bottom: var(--spacing-sm);
    }

    .form-desc {
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xl);
    }

    .guest-notice {
        padding: var(--spacing-md);
        background: #FFF3E0;
        border-radius: var(--radius-md);
        margin-bottom: var(--spacing-lg);
        color: #E65100;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-md);
    }

    .form-actions {
        display: flex;
        gap: var(--spacing-md);
        justify-content: flex-end;
        margin-top: var(--spacing-xl);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const latInput = document.getElementById('latitude');
        const lngInput = document.getElementById('longitude');

        if (latInput && lngInput) {
            latInput.addEventListener('input', function (e) {
                const value = e.target.value;
                if (value.includes(',')) {
                    const parts = value.split(',');
                    if (parts.length === 2) {
                        const lat = parts[0].trim();
                        const lng = parts[1].trim();
                        latInput.value = lat;
                        lngInput.value = lng;
                        lngInput.focus();
                    }
                }
            });
        }
    });
</script>
{% endblock %}
{% extends 'base.html' %}

{% block title %}ì‹ ê³  ëª©ë¡ - ê´€ë¦¬ì{% endblock %}

{% block content %}
<div class="container">
    <div class="admin-page">
        <div class="page-header">
            <a href="{% url 'admin_panel:dashboard' %}" class="back-link">â† ëŒ€ì‹œë³´ë“œ</a>
            <h1 class="page-title">ğŸš¨ ì‹ ê³  ëª©ë¡</h1>
        </div>

        <!-- í•„í„° -->
        <div class="filter-tabs">
            <a href="?status=PENDING" class="tab {% if status_filter == 'PENDING' %}active{% endif %}">ëŒ€ê¸°</a>
            <a href="?status=RESOLVED" class="tab {% if status_filter == 'RESOLVED' %}active{% endif %}">ì²˜ë¦¬ë¨</a>
            <a href="?status=DISMISSED" class="tab {% if status_filter == 'DISMISSED' %}active{% endif %}">ê¸°ê°</a>
            <a href="?status=" class="tab {% if not status_filter %}active{% endif %}">ì „ì²´</a>
        </div>

        {% if page_obj %}
        <div class="item-list">
            {% for report in page_obj %}
            <div class="report-item card">
                <div class="report-header">
                    <span
                        class="badge badge-{% if report.status == 'PENDING' %}warning{% elif report.status == 'RESOLVED' %}success{% else %}secondary{% endif %}">
                        {{ report.get_status_display }}
                    </span>
                    <span class="badge badge-primary">{{ report.get_reason_display }}</span>
                    <span class="report-date">{{ report.created_at|date:"Y.m.d H:i" }}</span>
                </div>

                <div class="report-content">
                    <div class="report-target">
                        <strong>ì‹ ê³  ëŒ€ìƒ:</strong>
                        {% if report.coordinate %}
                        <a href="{% url 'coordinates:detail' pk=report.coordinate.pk %}">
                            ì¢Œí‘œ - {{ report.coordinate.title }}
                        </a>
                        {% else %}
                        ëŒ“ê¸€ - "{{ report.comment.content|truncatewords:10 }}"
                        {% endif %}
                    </div>
                    <div class="report-reporter">
                        <strong>ì‹ ê³ ì:</strong> {{ report.reporter.nickname }}
                    </div>
                    {% if report.detail %}
                    <div class="report-detail">
                        <strong>ìƒì„¸ ë‚´ìš©:</strong>
                        <p>{{ report.detail }}</p>
                    </div>
                    {% endif %}
                </div>

                {% if report.status == 'PENDING' %}
                <div class="report-actions">
                    <form action="{% url 'admin_panel:resolve_report' pk=report.pk %}" method="post"
                        class="action-form">
                        {% csrf_token %}
                        <textarea name="admin_note" placeholder="ê´€ë¦¬ì ë©”ëª¨ (ì„ íƒ)" class="form-control"></textarea>
                        <div class="action-buttons">
                            <button type="submit" name="action" value="resolve" class="btn btn-danger">
                                ì‹ ê³  ìˆ˜ë½ (ëŒ€ìƒ ì‚­ì œ)
                            </button>
                            <button type="submit" name="action" value="dismiss" class="btn btn-outline">
                                ì‹ ê³  ê¸°ê°
                            </button>
                        </div>
                    </form>
                </div>
                {% else %}
                <div class="report-result">
                    {% if report.admin_note %}
                    <p><strong>ê´€ë¦¬ì ë©”ëª¨:</strong> {{ report.admin_note }}</p>
                    {% endif %}
                    <p class="resolved-info">
                        {{ report.resolved_by.nickname }}ë‹˜ì´ {{ report.resolved_at|date:"Y.m.d H:i" }}ì— ì²˜ë¦¬
                    </p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        {% if page_obj.has_other_pages %}
        <nav class="pagination">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&status={{ status_filter }}">â† ì´ì „</a>
            {% endif %}
            <span>{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&status={{ status_filter }}">ë‹¤ìŒ â†’</a>
            {% endif %}
        </nav>
        {% endif %}

        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">âœ…</div>
            <h2 class="empty-state-title">ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
        </div>
        {% endif %}
    </div>
</div>

<style>
    .admin-page {
        max-width: 900px;
        margin: var(--spacing-xl) auto;
    }

    .page-header {
        margin-bottom: var(--spacing-lg);
    }

    .back-link {
        display: inline-block;
        margin-bottom: var(--spacing-md);
        color: var(--text-secondary);
    }

    .filter-tabs {
        display: flex;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-lg);
    }

    .tab {
        padding: var(--spacing-sm) var(--spacing-lg);
        border-radius: var(--radius-full);
        background: var(--bg-primary);
        color: var(--text-secondary);
        font-weight: 500;
    }

    .tab.active {
        background: var(--primary);
        color: white;
    }

    .item-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
    }

    .report-item {
        padding: var(--spacing-lg);
    }

    .report-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-md);
    }

    .report-date {
        margin-left: auto;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .report-content {
        margin-bottom: var(--spacing-md);
    }

    .report-target,
    .report-reporter,
    .report-detail {
        margin-bottom: var(--spacing-sm);
    }

    .report-detail p {
        margin-top: var(--spacing-xs);
        padding: var(--spacing-sm);
        background: var(--bg-secondary);
        border-radius: var(--radius-sm);
    }

    .report-actions {
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--bg-tertiary);
    }

    .action-form textarea {
        margin-bottom: var(--spacing-md);
        min-height: 60px;
    }

    .action-buttons {
        display: flex;
        gap: var(--spacing-md);
    }

    .report-result {
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--bg-tertiary);
        font-size: 0.9rem;
    }

    .resolved-info {
        color: var(--text-secondary);
    }

    .badge-secondary {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
    }
</style>
{% endblock %}
{% extends 'base.html' %}

{% block title %}ì •ì§€ ëª©ë¡ - ê´€ë¦¬ì{% endblock %}

{% block content %}
<div class="container">
    <div class="admin-page">
        <div class="page-header">
            <h1>ğŸš« ì •ì§€ ëª©ë¡</h1>
            <div class="header-actions">
                <a href="{% url 'admin_panel:batch_post_management' %}" class="btn btn-outline">â† ê²Œì‹œê¸€ ê´€ë¦¬</a>
                <a href="{% url 'admin_panel:dashboard' %}" class="btn btn-outline">ëŒ€ì‹œë³´ë“œ</a>
            </div>
        </div>

        <!-- í•„í„° -->
        <div class="filter-tabs">
            <a href="?active=true" class="tab {% if show_active %}active{% endif %}">í™œì„± ì •ì§€</a>
            <a href="?active=false" class="tab {% if not show_active %}active{% endif %}">ëª¨ë“  ì •ì§€</a>
        </div>

        <!-- ì •ì§€ ëª©ë¡ -->
        <div class="ban-list">
            {% for ban in page_obj %}
            <div class="ban-item {% if not ban.is_active %}inactive{% endif %}">
                <div class="ban-target">
                    {% if ban.user %}
                    <span class="target-type user">ğŸ‘¤</span>
                    <span class="target-name">{{ ban.user.nickname }}</span>
                    {% endif %}
                    {% if ban.ip_address %}
                    <span class="target-type ip">ğŸŒ</span>
                    <span class="target-ip">{{ ban.ip_address }}</span>
                    {% endif %}
                </div>

                <div class="ban-info">
                    <div class="ban-duration">
                        <strong>{{ ban.get_duration_display }}</strong>
                        {% if ban.is_expired %}
                        <span class="expired-badge">ë§Œë£Œë¨</span>
                        {% elif not ban.is_active %}
                        <span class="unbanned-badge">í•´ì œë¨</span>
                        {% endif %}
                    </div>
                    <div class="ban-time">
                        {{ ban.banned_at|date:"Y-m-d H:i" }}
                        {% if ban.expires_at %}
                        ~ {{ ban.expires_at|date:"Y-m-d H:i" }}
                        {% else %}
                        (ì˜êµ¬)
                        {% endif %}
                    </div>
                    {% if ban.reason %}
                    <div class="ban-reason">ì‚¬ìœ : {{ ban.reason }}</div>
                    {% endif %}
                    <div class="ban-admin">ì •ì§€í•œ ê´€ë¦¬ì: {{ ban.banned_by.nickname|default:"ì‹œìŠ¤í…œ" }}</div>
                    {% if ban.unbanned_by %}
                    <div class="unban-info">í•´ì œ ê´€ë¦¬ì: {{ ban.unbanned_by.nickname }} ({{ ban.unbanned_at|date:"m/d H:i"
                        }})</div>
                    {% endif %}
                </div>

                <div class="ban-actions">
                    {% if ban.is_active and not ban.is_expired %}
                    <form method="post" action="{% url 'admin_panel:unban_user' ban.pk %}"
                        onsubmit="return confirm('ì •ì§€ë¥¼ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success btn-sm">ì •ì§€ í•´ì œ</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <p class="empty-message">ì •ì§€ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endfor %}
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&active={{ show_active }}">â† ì´ì „</a>
            {% endif %}
            <span>{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&active={{ show_active }}">ë‹¤ìŒ â†’</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<style>
    .admin-page {
        max-width: 900px;
        margin: var(--spacing-xl) auto;
        padding: var(--spacing-lg);
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }

    .header-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    .filter-tabs {
        display: flex;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
        border-bottom: 2px solid #eee;
    }

    .tab {
        padding: var(--spacing-md) var(--spacing-lg);
        text-decoration: none;
        color: var(--text-secondary);
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
    }

    .tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }

    .ban-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .ban-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-lg);
        background: var(--bg-primary);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        gap: var(--spacing-lg);
    }

    .ban-item.inactive {
        opacity: 0.6;
        background: var(--bg-secondary);
    }

    .ban-target {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        min-width: 150px;
    }

    .target-type {
        font-size: 1.5rem;
    }

    .target-name {
        font-weight: 600;
    }

    .target-ip {
        font-family: monospace;
        font-size: 0.9rem;
    }

    .ban-info {
        flex: 1;
    }

    .ban-duration {
        font-size: 1.1rem;
        margin-bottom: var(--spacing-xs);
    }

    .ban-time,
    .ban-reason,
    .ban-admin,
    .unban-info {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    .expired-badge,
    .unbanned-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-left: 8px;
    }

    .expired-badge {
        background: #E0E0E0;
        color: #616161;
    }

    .unbanned-badge {
        background: #E8F5E9;
        color: #2E7D32;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 0.85rem;
    }

    .btn-success {
        background: #4CAF50;
        color: white;
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: var(--spacing-lg);
        margin-top: var(--spacing-xl);
    }

    .empty-message {
        text-align: center;
        color: var(--text-secondary);
        padding: var(--spacing-xl);
    }

    @media (max-width: 768px) {
        .ban-item {
            flex-direction: column;
            align-items: flex-start;
        }
    }
</style>
{% endblock %}
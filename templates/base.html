{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬{% endblock %}</title>
    <meta name="description"
        content="{% block description %}í”¼í¬ë¯¼ ë¸”ë£¸ ë²„ì„¯ ì¢Œí‘œ, ëª¨ì¢… ì¢Œí‘œ, ë¹…í”Œë¼ì›Œ ìœ„ì¹˜, ì—½ì„œ ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ìœ ì € ì»¤ë®¤ë‹ˆí‹°{% endblock %}">

    <!-- SEO Meta Tags -->
    <meta name="keywords"
        content="{% block keywords %}í”¼í¬ë¯¼, í”¼í¬ë¯¼ ë¸”ë£¸, Pikmin Bloom, ãƒ”ã‚¯ãƒŸãƒ³ ãƒ–ãƒ«ãƒ¼ãƒ {% endblock %}">
    <meta name="robots" content="index, follow">
    <meta name="author" content="í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬">

    <!-- Open Graph (Facebook, KakaoTalk, etc.) -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬">
    <meta property="og:title" content="{% block og_title %}í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬ - í”¼í¬ë¯¼ ë¸”ë£¸ ì¢Œí‘œ ì»¤ë®¤ë‹ˆí‹°{% endblock %}">
    <meta property="og:description"
        content="{% block og_description %}í”¼í¬ë¯¼ ë¸”ë£¸ ë²„ì„¯, ëª¨ì¢…, ë¹…í”Œë¼ì›Œ ì¢Œí‘œë¥¼ ê³µìœ í•˜ê³  ë†ì‚¬ ì •ë³´ë¥¼ ë‚˜ëˆ ìš”!{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% static 'img/og-default.png' %}{% endblock %}">
    {% block og_url %}
    <meta property="og:url" content="">{% endblock %}
    <meta property="og:locale" content="ko_KR">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}í”¼í¬ë¯¼ ë¸”ë£¸ ì¢Œí‘œ ê³µìœ  ì»¤ë®¤ë‹ˆí‹°{% endblock %}">

    <!-- Canonical URL -->
    {% block canonical %}{% endblock %}

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}?v=20260220a">
    <link rel="stylesheet" href="{% static 'css/seasons.css' %}?v=20260103d">
    {% block extra_css %}{% endblock %}

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>

<body data-season="winter" data-weather="clear" data-time="day">
    <!-- ë‚ ì”¨ íš¨ê³¼ ì»¨í…Œì´ë„ˆ -->
    <div class="weather-effects">
        <!-- íƒœì–‘/ë‹¬ (CSSë¡œ ìŠ¤íƒ€ì¼ë§) -->
        <div class="sky-object sun" aria-hidden="true"></div>
        <div class="sky-object moon" aria-hidden="true"></div>

        <div class="snowflakes" aria-hidden="true">
            {% for i in "12345678901234567890" %}
            <div class="snowflake">â„</div>
            {% endfor %}
        </div>
        <div class="raindrops" aria-hidden="true">
            {% for i in "123456789012345678901234567890" %}
            <div class="raindrop"></div>
            {% endfor %}
        </div>
        <div class="petals" aria-hidden="true">
            {% for i in "1234567890" %}
            <div class="petal">ğŸŒ¸</div>
            {% endfor %}
        </div>
        <div class="leaves" aria-hidden="true">
            {% for i in "1234567890" %}
            <div class="leaf">ğŸ‚</div>
            {% endfor %}
        </div>
    </div>

    {% block header %}
    <!-- ê¸°ë³¸ í—¤ë” (ëœë”© í˜ì´ì§€ì—ì„œëŠ” ìˆ¨ê¹€) -->
    <header class="main-header">
        <div class="container">
            <a href="{% url 'core:landing' %}" class="logo">
                <span class="logo-icon">ğŸŒ±</span>
                <span class="logo-text">í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬</span>
            </a>

            <nav class="main-nav" aria-label="ë©”ì¸ ë‚´ë¹„ê²Œì´ì…˜">
                <a href="{% url 'coordinates:list' %}" class="nav-link">ì¢Œí‘œ ëª©ë¡</a>
                <a href="{% url 'farming:home' %}" class="nav-link">ë†ì‚¬</a>
                <a href="{% url 'rankings:list' %}" class="nav-link">ë­í‚¹</a>
                <a href="{% url 'core:guide' %}" class="nav-link">ì•ˆë‚´</a>
                <a href="{% url 'core:suggestion' %}" class="nav-link">ê±´ì˜í•˜ê¸°</a>
            </nav>

            <div class="header-actions">
                <!-- ê³„ì ˆ/ë‚ ì”¨ ì„ íƒ -->
                <div class="theme-selector">
                    <button class="theme-btn" aria-label="í…Œë§ˆ ì„ íƒ" aria-expanded="false" aria-haspopup="true">ğŸ¨</button>
                    <div class="theme-dropdown" role="menu" aria-label="í…Œë§ˆ ë©”ë‰´">
                        <div class="season-menu">
                            <div class="season-item" data-season="spring">
                                <span class="season-label">ğŸŒ¸ ë´„</span>
                                <div class="weather-submenu" role="group" aria-label="ë´„ ë‚ ì”¨">
                                    <button role="menuitem" onclick="setTheme('spring', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button role="menuitem" onclick="setTheme('spring', 'rain')">ğŸŒ§ï¸ ë¹„</button>
                                    <button role="menuitem" onclick="setTheme('spring', 'cloudy')">â˜ï¸ íë¦¼</button>
                                </div>
                            </div>
                            <div class="season-item" data-season="summer">
                                <span class="season-label">ğŸŒ» ì—¬ë¦„</span>
                                <div class="weather-submenu" role="group" aria-label="ì—¬ë¦„ ë‚ ì”¨">
                                    <button role="menuitem" onclick="setTheme('summer', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button role="menuitem" onclick="setTheme('summer', 'rain')">ğŸŒ§ï¸ ë¹„</button>
                                    <button role="menuitem" onclick="setTheme('summer', 'storm')">â›ˆï¸ í­í’</button>
                                </div>
                            </div>
                            <div class="season-item" data-season="fall">
                                <span class="season-label">ğŸ‚ ê°€ì„</span>
                                <div class="weather-submenu" role="group" aria-label="ê°€ì„ ë‚ ì”¨">
                                    <button role="menuitem" onclick="setTheme('fall', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button role="menuitem" onclick="setTheme('fall', 'cloudy')">â˜ï¸ íë¦¼</button>
                                    <button role="menuitem" onclick="setTheme('fall', 'wind')">ğŸ’¨ ë°”ëŒ</button>
                                </div>
                            </div>
                            <div class="season-item" data-season="winter">
                                <span class="season-label">â„ï¸ ê²¨ìš¸</span>
                                <div class="weather-submenu" role="group" aria-label="ê²¨ìš¸ ë‚ ì”¨">
                                    <button role="menuitem" onclick="setTheme('winter', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button role="menuitem" onclick="setTheme('winter', 'snow')">ğŸŒ¨ï¸ ëˆˆ</button>
                                    <button role="menuitem" onclick="setTheme('winter', 'cloudy')">â˜ï¸ íë¦¼</button>
                                </div>
                            </div>
                            <div class="season-divider"></div>
                            <!-- ë‚®/ë°¤ ì„ íƒ -->
                            <div class="time-toggle">
                                <span class="toggle-label">ì‹œê°„ëŒ€</span>
                                <div class="toggle-buttons">
                                    <button onclick="setTimeMode('day')" class="time-btn" data-time="day">ğŸŒ¤ï¸ ë‚®</button>
                                    <button onclick="setTimeMode('night')" class="time-btn" data-time="night">ğŸŒ™
                                        ë°¤</button>
                                </div>
                            </div>
                            <div class="season-divider"></div>
                            <button class="auto-theme-btn" onclick="setAutoTheme()">ğŸ”„ ìë™ (ìœ„ì¹˜ ê¸°ë°˜)</button>
                        </div>
                    </div>
                </div>

                <!-- ì•Œë¦¼ (ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í‘œì‹œ) -->
                <div class="notification-wrapper">
                    <button class="notification-btn" id="notificationBtn" aria-label="ì•Œë¦¼" aria-expanded="false" aria-haspopup="true">
                        ğŸ””
                        {% if user.is_authenticated %}
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        {% endif %}
                    </button>
                    <div class="notification-dropdown" id="notificationDropdown" role="region" aria-label="ì•Œë¦¼ ëª©ë¡">
                        <div class="notification-dropdown-inner">
                            {% if user.is_authenticated %}
                            <div class="notification-tabs">
                                <button class="notification-tab active" data-tab="comment">ğŸ’¬ ëŒ“ê¸€ <span class="tab-badge" id="tabBadgeComment" style="display:none;">0</span></button>
                                <button class="notification-tab" data-tab="other">ğŸ”” ê¸°íƒ€ <span class="tab-badge" id="tabBadgeOther" style="display:none;">0</span></button>
                            </div>
                            {% else %}
                            <div class="notification-header">ì•Œë¦¼</div>
                            {% endif %}
                            <div class="notification-list" id="notificationList" aria-live="polite">
                                {% if user.is_authenticated %}
                                <div class="notification-empty">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
                                {% else %}
                                <div class="notification-empty notification-guest">ğŸ”’ ë¹„íšŒì›ì€ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br><a
                                        href="{% url 'account_login' %}">ë¡œê·¸ì¸í•˜ê¸°</a></div>
                                {% endif %}
                            </div>
                            {% if user.is_authenticated %}
                            <div class="notification-footer">
                                <button class="notification-mark-all" id="markAllReadBtn">ëª¨ë‘ ì½ìŒ ì²˜ë¦¬</button>
                                <button class="notification-delete-all" id="deleteAllBtn">ëª¨ë‘ ì‚­ì œ</button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% if user.is_authenticated %}
                <a href="{% url 'accounts:my_page' %}" class="btn btn-outline">ë§ˆì´í˜ì´ì§€</a>
                <a href="{% url 'account_logout' %}" class="btn btn-text">ë¡œê·¸ì•„ì›ƒ</a>
                {% else %}
                <a href="{% url 'account_login' %}" class="btn btn-primary">ë¡œê·¸ì¸</a>
                {% endif %}
            </div>

            <!-- ëª¨ë°”ì¼ ì•„ì´ì½˜ë“¤ (ğŸ¨ ğŸ”” ì˜†ì— â˜°) -->
            <div class="mobile-header-icons">
                <div class="theme-selector">
                    <button class="theme-btn" aria-label="í…Œë§ˆ ì„ íƒ">ğŸ¨</button>
                    <div class="theme-dropdown">
                        <div class="season-menu">
                            <div class="season-item" data-season="spring">
                                <span class="season-label">ğŸŒ¸ ë´„</span>
                                <div class="weather-submenu">
                                    <button onclick="setTheme('spring', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button onclick="setTheme('spring', 'rain')">ğŸŒ§ï¸ ë¹„</button>
                                    <button onclick="setTheme('spring', 'cloudy')">â˜ï¸ íë¦¼</button>
                                </div>
                            </div>
                            <div class="season-item" data-season="summer">
                                <span class="season-label">ğŸŒ» ì—¬ë¦„</span>
                                <div class="weather-submenu">
                                    <button onclick="setTheme('summer', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button onclick="setTheme('summer', 'rain')">ğŸŒ§ï¸ ë¹„</button>
                                    <button onclick="setTheme('summer', 'storm')">â›ˆï¸ í­í’</button>
                                </div>
                            </div>
                            <div class="season-item" data-season="fall">
                                <span class="season-label">ğŸ‚ ê°€ì„</span>
                                <div class="weather-submenu">
                                    <button onclick="setTheme('fall', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button onclick="setTheme('fall', 'cloudy')">â˜ï¸ íë¦¼</button>
                                    <button onclick="setTheme('fall', 'wind')">ğŸ’¨ ë°”ëŒ</button>
                                </div>
                            </div>
                            <div class="season-item" data-season="winter">
                                <span class="season-label">â„ï¸ ê²¨ìš¸</span>
                                <div class="weather-submenu">
                                    <button onclick="setTheme('winter', 'clear')">â˜€ï¸ ë§‘ìŒ</button>
                                    <button onclick="setTheme('winter', 'snow')">ğŸŒ¨ï¸ ëˆˆ</button>
                                    <button onclick="setTheme('winter', 'cloudy')">â˜ï¸ íë¦¼</button>
                                </div>
                            </div>
                            <div class="season-divider"></div>
                            <div class="time-toggle">
                                <span class="toggle-label">ì‹œê°„ëŒ€</span>
                                <div class="toggle-buttons">
                                    <button onclick="setTimeMode('day')" class="time-btn" data-time="day">ğŸŒ¤ï¸ ë‚®</button>
                                    <button onclick="setTimeMode('night')" class="time-btn" data-time="night">ğŸŒ™
                                        ë°¤</button>
                                </div>
                            </div>
                            <div class="season-divider"></div>
                            <button class="auto-theme-btn" onclick="setAutoTheme()">ğŸ”„ ìë™ (ìœ„ì¹˜ ê¸°ë°˜)</button>
                        </div>
                    </div>
                </div>
                <!-- ì•Œë¦¼ (ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í‘œì‹œ) -->
                <div class="notification-wrapper">
                    <button class="notification-btn" id="notificationBtnMobile" aria-label="ì•Œë¦¼">
                        ğŸ””
                        {% if user.is_authenticated %}
                        <span class="notification-badge" id="notificationBadgeMobile" style="display: none;">0</span>
                        {% endif %}
                    </button>
                    <div class="notification-dropdown" id="notificationDropdownMobile">
                        <div class="notification-dropdown-inner">
                            {% if user.is_authenticated %}
                            <div class="notification-tabs">
                                <button class="notification-tab active" data-tab="comment">ğŸ’¬ ëŒ“ê¸€ <span class="tab-badge" id="tabBadgeCommentMobile" style="display:none;">0</span></button>
                                <button class="notification-tab" data-tab="other">ğŸ”” ê¸°íƒ€ <span class="tab-badge" id="tabBadgeOtherMobile" style="display:none;">0</span></button>
                            </div>
                            {% else %}
                            <div class="notification-header">ì•Œë¦¼</div>
                            {% endif %}
                            <div class="notification-list" id="notificationListMobile">
                                {% if user.is_authenticated %}
                                <div class="notification-empty">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
                                {% else %}
                                <div class="notification-empty notification-guest">ğŸ”’ ë¹„íšŒì›ì€ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br><a
                                        href="{% url 'account_login' %}">ë¡œê·¸ì¸í•˜ê¸°</a></div>
                                {% endif %}
                            </div>
                            {% if user.is_authenticated %}
                            <div class="notification-footer">
                                <button class="notification-mark-all" id="markAllReadBtnMobile">ëª¨ë‘ ì½ìŒ ì²˜ë¦¬</button>
                                <button class="notification-delete-all" id="deleteAllBtnMobile">ëª¨ë‘ ì‚­ì œ</button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <button class="mobile-menu-btn" aria-label="ë©”ë‰´ ì—´ê¸°" aria-expanded="false" aria-controls="mobileMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>

            <!-- ëª¨ë°”ì¼ ë©”ë‰´ (ë“œë¡­ë‹¤ìš´) -->
            <div class="mobile-menu" id="mobileMenu" role="navigation" aria-label="ëª¨ë°”ì¼ ë©”ë‰´">
                {% if user.is_authenticated %}
                <a href="{% url 'accounts:my_page' %}" class="mobile-menu-item mobile-menu-auth">ë§ˆì´í˜ì´ì§€</a>
                <a href="{% url 'account_logout' %}" class="mobile-menu-item mobile-menu-logout">ë¡œê·¸ì•„ì›ƒ</a>
                {% else %}
                <a href="{% url 'account_login' %}" class="mobile-menu-item mobile-menu-login">ë¡œê·¸ì¸</a>
                {% endif %}
                <div class="mobile-menu-divider"></div>
                <a href="{% url 'coordinates:list' %}" class="mobile-menu-item">ì¢Œí‘œ ëª©ë¡</a>
                <a href="{% url 'farming:home' %}" class="mobile-menu-item">ë†ì‚¬</a>
                <a href="{% url 'rankings:list' %}" class="mobile-menu-item">ë­í‚¹</a>
                <a href="{% url 'core:guide' %}" class="mobile-menu-item">ì•ˆë‚´</a>
                <a href="{% url 'core:suggestion' %}" class="mobile-menu-item">ğŸ’Œ ê±´ì˜í•˜ê¸°</a>
            </div>
        </div>
    </header>
    {% endblock %}

    <!-- ë©”ì‹œì§€ ì•Œë¦¼ -->
    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="message message-{{ message.tags }}">
            {{ message }}
            <button class="message-close" onclick="this.parentElement.remove()" aria-label="ë‹«ê¸°">Ã—</button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    {% block footer %}
    <footer class="main-footer">
        <div class="container">
            <p>Â© {% now "Y" %} í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬ ì»¤ë®¤ë‹ˆí‹°</p>
            <p class="footer-note">ì´ ì‚¬ì´íŠ¸ëŠ” Nintendo ë˜ëŠ” Nianticê³¼ ê´€ë ¨ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </footer>
    {% endblock %}

    <!-- JS ë²ˆì—­ ë¬¸ìì—´ -->
    <script>
    var TRANSLATIONS = {
        themeApplied: "í…Œë§ˆ ì ìš©!",
        autoThemeSwitch: "ìë™ í…Œë§ˆ ëª¨ë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤...",
        dayMode: "ë‚® ëª¨ë“œ ì ìš©!",
        nightMode: "ë°¤ ëª¨ë“œ ì ìš©!",
        coordsCopied: "ì¢Œí‘œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!",
        copyFailed: "ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
        copied: "ë³µì‚¬ë¨",
        copy: "ë³µì‚¬",
        noNotifications: "ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤",
        loadNotifFailed: "ì•Œë¦¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
        deleteAllConfirm: "ëª¨ë“  ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        spring: "ë´„",
        summer: "ì—¬ë¦„",
        fall: "ê°€ì„",
        winter: "ê²¨ìš¸",
        clear: "ë§‘ìŒ",
        rain: "ë¹„",
        snow: "ëˆˆ",
        storm: "í­í’",
        cloudy: "íë¦¼",
        wind: "ë°”ëŒ"
    };
    </script>

    <!-- JavaScript -->
    <script src="{% static 'js/weather-theme.js' %}?v=20260103e"></script>
    <script src="{% static 'js/main.js' %}?v=20260220a"></script>
    {% block extra_js %}{% endblock %}
</body>

</html>

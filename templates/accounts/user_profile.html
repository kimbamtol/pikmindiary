{% extends 'base.html' %}

{% block title %}{{ profile_user.nickname }} í”„ë¡œí•„ - í”¼í¬ë¯¼ ë‹¤ì´ì–´ë¦¬{% endblock %}

{% block content %}
<div class="container">
    <div class="profile-page">
        <a href="{% url 'coordinates:list' %}" class="back-link">â† ëª©ë¡ìœ¼ë¡œ</a>

        <!-- í”„ë¡œí•„ ì¹´ë“œ -->
        <div class="profile-card card">
            <div class="profile-header">
                <div class="profile-avatar">
                    {% if profile_user.profile_image %}
                    <img src="{{ profile_user.profile_image.url }}" alt="{{ profile_user.nickname }}">
                    {% else %}
                    <div class="avatar-placeholder">{{ profile_user.nickname|slice:":1" }}</div>
                    {% endif %}
                </div>
                <div class="profile-info">
                    <h1>{{ profile_user.nickname }}</h1>
                    {% if profile_user.bio %}
                    <p class="profile-bio">{{ profile_user.bio }}</p>
                    {% endif %}
                </div>
            </div>

            <div class="profile-stats">
                <div class="stat">
                    <span class="stat-value">{{ total_posts }}</span>
                    <span class="stat-label">ì‘ì„± ê¸€</span>
                </div>
                <div class="stat">
                    <span class="stat-value">{{ total_likes }}</span>
                    <span class="stat-label">ë°›ì€ ì¢‹ì•„ìš”</span>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ ê¸€ -->
        <h2 class="section-title">ğŸ“ ìµœê·¼ ì‘ì„±í•œ ê¸€</h2>
        {% if posts %}
        <div class="coord-grid grid grid-3">
            {% for coord in posts %}
            <article class="card coord-card">
                <a href="{% url 'coordinates:detail' pk=coord.pk %}">
                    <div class="coord-card-image">
                        {% if coord.images.first %}
                        <img src="{{ coord.images.first.image.url }}" alt="{{ coord.title }}">
                        {% else %}
                        <div class="coord-card-placeholder">ğŸ—ºï¸</div>
                        {% endif %}
                    </div>
                    <div class="coord-card-content">
                        <h3 class="coord-card-title">{{ coord.title }}</h3>
                        <span class="coord-card-date">{{ coord.created_at|date:"m/d" }}</span>
                    </div>
                </a>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-posts">ì•„ì§ ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}

        <!-- ìµœê·¼ ëŒ“ê¸€ -->
        <h2 class="section-title">ğŸ’¬ ìµœê·¼ ë‚¨ê¸´ ëŒ“ê¸€</h2>
        {% if recent_comments %}
        <div class="comments-list">
            {% for comment in recent_comments %}
            <a href="{% if comment.coordinate %}{% url 'coordinates:detail' pk=comment.coordinate.pk %}{% elif comment.farming_journal %}{% url 'farming:journal_detail' pk=comment.farming_journal.pk %}{% endif %}" class="comment-item card">
                <div class="comment-icon">
                    {% if comment.photo %}ğŸ“·{% else %}ğŸ’¬{% endif %}
                </div>
                <div class="comment-body">
                    <div class="comment-target">
                        {% if comment.coordinate %}
                        <span class="target-badge">ì¢Œí‘œ</span>
                        <span class="target-title">{{ comment.coordinate.title }}</span>
                        {% elif comment.farming_journal %}
                        <span class="target-badge">ì¼ì§€</span>
                        <span class="target-title">{{ comment.farming_journal.title }}</span>
                        {% endif %}
                    </div>
                    <p class="comment-text">
                        {% if comment.content %}
                        {{ comment.content|truncatechars:80 }}
                        {% else %}
                        <em>(ì‚¬ì§„ ëŒ“ê¸€)</em>
                        {% endif %}
                    </p>
                    <span class="comment-date">{{ comment.created_at|date:"m/d H:i" }}</span>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-posts">ì•„ì§ ë‚¨ê¸´ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}

        <!-- ë†ì‚¬ ì¼ì§€ -->
        {% if farming_journals %}
        <h2 class="section-title">ğŸŒ¾ ë†ì‚¬ ì¼ì§€</h2>
        <div class="coord-grid grid grid-3">
            {% for journal in farming_journals %}
            <article class="card coord-card">
                <a href="{% url 'farming:journal_detail' pk=journal.pk %}">
                    <div class="coord-card-image">
                        {% if journal.image %}
                        <img src="{{ journal.image.url }}" alt="{{ journal.title }}">
                        {% else %}
                        <div class="coord-card-placeholder">ğŸŒ¾</div>
                        {% endif %}
                    </div>
                    <div class="coord-card-content">
                        <h3 class="coord-card-title">{{ journal.title }}</h3>
                        <span class="coord-card-date">{{ journal.created_at|date:"m/d" }}</span>
                    </div>
                </a>
            </article>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<style>
    .profile-page {
        max-width: 900px;
        margin: var(--spacing-xl) auto;
    }

    .back-link {
        display: inline-block;
        margin-bottom: var(--spacing-md);
        color: var(--text-secondary);
    }

    .profile-card {
        margin-bottom: var(--spacing-xl);
        overflow: hidden;
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-lg);
        padding: var(--spacing-xl);
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        overflow: hidden;
        flex-shrink: 0;
    }

    .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .avatar-placeholder {
        width: 100%;
        height: 100%;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: 700;
    }

    .profile-info h1 {
        margin-bottom: var(--spacing-sm);
    }

    .profile-bio {
        color: var(--text-secondary);
    }

    .profile-stats {
        display: flex;
        border-top: 1px solid var(--bg-tertiary);
    }

    .stat {
        flex: 1;
        text-align: center;
        padding: var(--spacing-lg);
    }

    .stat-value {
        display: block;
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
    }

    .stat-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .section-title {
        margin-bottom: var(--spacing-lg);
    }

    .coord-card-placeholder {
        width: 100%;
        aspect-ratio: 16/9;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-tertiary);
        font-size: 3rem;
    }

    .coord-card-date {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .no-posts {
        text-align: center;
        color: var(--text-secondary);
        padding: var(--spacing-xl);
    }

    .comments-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-xl);
    }

    .comment-item {
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        color: var(--text-primary);
    }

    .comment-item:hover {
        background: var(--bg-secondary);
    }

    .comment-icon {
        font-size: 1.25rem;
        flex-shrink: 0;
    }

    .comment-body {
        flex: 1;
        min-width: 0;
    }

    .comment-target {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-xs);
    }

    .target-badge {
        font-size: 0.7rem;
        padding: 2px 6px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
    }

    .target-title {
        font-weight: 600;
        font-size: 0.9rem;
    }

    .comment-text {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
        line-height: 1.4;
    }

    .comment-date {
        font-size: 0.75rem;
        color: var(--text-tertiary);
    }

    @media (max-width: 480px) {
        .profile-header {
            flex-direction: column;
            text-align: center;
        }
    }
</style>
{% endblock %}